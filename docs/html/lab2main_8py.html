<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ME 405 Lab 2 - Tom, Jonathan, Dylan: src/lab2main.py File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ME 405 Lab 2 - Tom, Jonathan, Dylan<span id="projectnumber">&#160;405_2</span>
   </div>
   <div id="projectbrief">DC Motor P-Controller w/ MotrDriver, EncoderReader, and Control classes</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('lab2main_8py.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">lab2main.py File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>This file is Lab 2 for ME 405.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:af77336d67582e8c6cae8a642dff48231"><td class="memItemLeft" align="right" valign="top"><a id="af77336d67582e8c6cae8a642dff48231" name="af77336d67582e8c6cae8a642dff48231"></a>
def&#160;</td><td class="memItemRight" valign="bottom"><b>lab2main.main</b> ()</td></tr>
<tr class="separator:af77336d67582e8c6cae8a642dff48231"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a52847291d9a61c8a11afb307cb44312e"><td class="memItemLeft" align="right" valign="top"><a id="a52847291d9a61c8a11afb307cb44312e" name="a52847291d9a61c8a11afb307cb44312e"></a>
pyb&#160;</td><td class="memItemRight" valign="bottom"><b>lab2main.enablePin</b> = pyb.Pin.board.PA10</td></tr>
<tr class="separator:a52847291d9a61c8a11afb307cb44312e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae091212dde5d56672f8fdd42a9d2b140"><td class="memItemLeft" align="right" valign="top"><a id="ae091212dde5d56672f8fdd42a9d2b140" name="ae091212dde5d56672f8fdd42a9d2b140"></a>
pyb&#160;</td><td class="memItemRight" valign="bottom"><b>lab2main.input1Pin</b> = pyb.Pin.board.PB4</td></tr>
<tr class="separator:ae091212dde5d56672f8fdd42a9d2b140"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa969db1eba37c5bd3f6cb49c9760aa13"><td class="memItemLeft" align="right" valign="top"><a id="aa969db1eba37c5bd3f6cb49c9760aa13" name="aa969db1eba37c5bd3f6cb49c9760aa13"></a>
pyb&#160;</td><td class="memItemRight" valign="bottom"><b>lab2main.input2Pin</b> = pyb.Pin.board.PB5</td></tr>
<tr class="separator:aa969db1eba37c5bd3f6cb49c9760aa13"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af33677fba07bbde25b35572f66f30544"><td class="memItemLeft" align="right" valign="top"><a id="af33677fba07bbde25b35572f66f30544" name="af33677fba07bbde25b35572f66f30544"></a>
pyb&#160;</td><td class="memItemRight" valign="bottom"><b>lab2main.encoder1Pin</b> = pyb.Pin.board.PB6</td></tr>
<tr class="separator:af33677fba07bbde25b35572f66f30544"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad648154ec0df598051e0d2e298c13aba"><td class="memItemLeft" align="right" valign="top"><a id="ad648154ec0df598051e0d2e298c13aba" name="ad648154ec0df598051e0d2e298c13aba"></a>
pyb&#160;</td><td class="memItemRight" valign="bottom"><b>lab2main.encoder2Pin</b> = pyb.Pin.board.PB7</td></tr>
<tr class="separator:ad648154ec0df598051e0d2e298c13aba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaeb0a5663fecaed73c6dc7435595c06c"><td class="memItemLeft" align="right" valign="top"><a id="aaeb0a5663fecaed73c6dc7435595c06c" name="aaeb0a5663fecaed73c6dc7435595c06c"></a>
pyb&#160;</td><td class="memItemRight" valign="bottom"><b>lab2main.motorTimer</b> = pyb.Timer(3, freq=20000)</td></tr>
<tr class="separator:aaeb0a5663fecaed73c6dc7435595c06c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee017f4afa9c3e6fdcf7a0c555ccaec8"><td class="memItemLeft" align="right" valign="top"><a id="aee017f4afa9c3e6fdcf7a0c555ccaec8" name="aee017f4afa9c3e6fdcf7a0c555ccaec8"></a>
pyb&#160;</td><td class="memItemRight" valign="bottom"><b>lab2main.encoderTimer</b> = pyb.Timer(4, prescaler=0, period=0xFFFF)</td></tr>
<tr class="separator:aee017f4afa9c3e6fdcf7a0c555ccaec8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a780a0e8aa9260aeba4a29a09311afb80"><td class="memItemLeft" align="right" valign="top"><a id="a780a0e8aa9260aeba4a29a09311afb80" name="a780a0e8aa9260aeba4a29a09311afb80"></a>
MotorDriver&#160;</td><td class="memItemRight" valign="bottom"><b>lab2main.motor1</b> = MotorDriver(enablePin, input1Pin, input2Pin, motorTimer)</td></tr>
<tr class="separator:a780a0e8aa9260aeba4a29a09311afb80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac484e12f81bc365d57682beabc62ba5b"><td class="memItemLeft" align="right" valign="top"><a id="ac484e12f81bc365d57682beabc62ba5b" name="ac484e12f81bc365d57682beabc62ba5b"></a>
EncoderReader&#160;</td><td class="memItemRight" valign="bottom"><b>lab2main.encoder1</b> = EncoderReader(encoder1Pin, encoder2Pin, 0, 0)</td></tr>
<tr class="separator:ac484e12f81bc365d57682beabc62ba5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af93482fb8440fae933a05b73619641a5"><td class="memItemLeft" align="right" valign="top"><a id="af93482fb8440fae933a05b73619641a5" name="af93482fb8440fae933a05b73619641a5"></a>
pyb&#160;</td><td class="memItemRight" valign="bottom"><b>lab2main.ser</b> = pyb.UART(2, baudrate=115200, timeout = 10)</td></tr>
<tr class="separator:af93482fb8440fae933a05b73619641a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file is Lab 2 for ME 405. </p>
<p>The goal of this exercise was to control a 12V DC motor system as a servo system with a proportional controller. The motor is connected to an external power supply and a STM32 PWM output. The built-in encoder provides position feedback and uses STM-32 timers. At the beginning of the program sequence, controller parameters are sent through UART serial communication to the STM32, initializing the control algorithm.</p>
<p>The proportional controller is the most simple closed-loop controller, using just one variable (Kp, the controller constant), to direcetly impact the amount of "effort" that the motor applies. The "effort" applied to the motor is a duty cycle percentage. To find the required duty cycle, the algorithm calculates the difference between the setpoint (goal) and the actual position and multiplies it by the proportional controller constant. A higher error implies a higher corrective effort, while a lower error applied a lower corrective effort. Eventually, the error becomes negligible and no further correction is needed.</p>
<p>This program uses 3 classes: MotorDriver, EncoderReader, and Control. After defining the pins and starting the timer channels, the control loop waits for motor parameters. Once the controller parameters (Kp and setpt) are received from the PC. The encoder reads the position, which is used by the controller to calculate the required duty cycle, which is applied to the motor. This loop runs for 3 seconds.</p>
<dl class="section author"><dt>Author</dt><dd>Tom Taylor </dd>
<dd>
Jonathan Fraser </dd>
<dd>
Dylan Weiglein</dd></dl>
<dl class="section date"><dt>Date</dt><dd>2022-02-08 </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="lab2main_8py.html">lab2main.py</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
